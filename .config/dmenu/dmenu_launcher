#!/bin/sh

# Diretório de cache/histórico
cachedir="${XDG_CACHE_HOME:-"$HOME/.cache"}"
history="$cachedir/dmenu_run_history"

mkdir -p "$cachedir"

# Lista todos os executáveis
apps=$(dmenu_path)

# Coloca apps usados recentemente no topo
if [ -f "$history" ]; then
    used=$(grep -Fx -f "$history" <<< "$apps")
    unused=$(grep -Fxv -f "$history" <<< "$apps")
    apps="$used"$'\n'"$unused"
fi

# Mostra no dmenu e pega escolha
chosen=$(echo "$apps" | dmenu "$@") || exit

# Atualiza histórico: remove entrada antiga e coloca no topo
grep -Fxv "$chosen" "$history" 2>/dev/null > "$history.tmp"
echo "$chosen" > "$history.tmp2"
cat "$history.tmp" >> "$history.tmp2"
mv "$history.tmp2" "$history"

# Executa o app
${SHELL:-"/bin/sh"} -c "$chosen" &

# #!/bin/sh
# # 1. Obter executáveis do PATH e remover itens indesejados
# # Exemplo: remove executáveis que contenham 'intel' ou 'lib'
# executables=$(dmenu_path | grep -v 'intel\|python\|cargo\|amd\|env\|grep\|abrt')
#
# # 2. Exibir no dmenu e executar o comando selecionado
# selected=$(printf '%s\n' "$executables" | dmenu "$@")
#
# # 3. Executar o comando selecionado, se houver
# [ -n "$selected" ] && exec ${SHELL:-/bin/sh} -c "$selected"
