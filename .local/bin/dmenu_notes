#!/usr/bin/env bash

folder="$HOME/notes/"

# Cria o diretório se não existir
mkdir -p "$folder"

# Função para criar uma nova nota
newnote() {
  dir="$(command ls -d "$folder" "$folder"*/ 2>/dev/null | dmenu -c -l 5 -i -p 'Choose directory: ')" || exit 0
  : "${dir:=$folder}"

  name="$(echo "" | dmenu -c -sb "#a3be8c" -nf "#d8dee9" -p "Enter a name: ")" || exit 0
  : "${name:=$(date +%F_%H-%M-%S)}"

  file="$dir/$name.md"
  mkdir -p "$(dirname "$file")"
  
  # setsid -f "$TERMINAL" -e "$EDITOR" "$file" >/dev/null 2>&1
  setsid -f "$TERMINAL" -e tmux new-window "$EDITOR" "$file" >/dev/null 2>&1
}

# Função principal — escolher nota existente ou criar nova
selected() {
  choice=$(
    echo -e "New\n$(find "$folder" -type f -name "*.md" -printf '%T@ %P\n' 2>/dev/null | sort -nr | cut -d' ' -f2-)" \
    | dmenu -c -l 10 -i -p "Choose note or create new:"
  )

  case "$choice" in
    New) newnote ;;
    # *.md) setsid -f "$TERMINAL" -e "$EDITOR" "$folder/$choice" >/dev/null 2>&1 ;;
    *.md) setsid -f "$TERMINAL" -e tmux new-window "$EDITOR" "$folder/$choice" >/dev/null 2>&1 ;;
    *) exit ;;
  esac
}

selected
